<!DOCTYPE html>
<html lang="en">
@{
    Layout = "";
}

@{
    IList<SymbolIndex.Models.Font> fonts = ViewBag.Fonts;
    IList<SymbolIndex.Models.Symbol> symbols = ViewBag.Symbols;
    SymbolIndex.Models.Font fontCurrent = ViewBag.FontCurrent;
}

<head>
    @Html.Partial("_GG")
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Symbol Search</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="~/Assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/Assets/font-awesome/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="~/Assets/css/mycss.css">
    <link rel="stylesheet" href="~/Content/bootstrap-select.min.css">

    <style>
        @@font-face {
            font-family: '@fontCurrent.FontName';
            src: url(@fontCurrent.FontUrl);
        }
        .myFont{
                font-family: '@fontCurrent.FontName';
        }

        .blink_me {
            border:dashed;
            border-width: 3px;
            border-color: chartreuse;
            animation: blinker 1s step-start infinite;
            padding-right: 5px;
        }

        @@keyframes blinker {
            25% {
            border-color: red;
            }
            50% {
            border-color: cyan;
            }
            75% {
            border-color: hotpink;
            }
        }

        /* Tooltip container */
        .mtooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted black; /* If you want dots under the hoverable text */
        }

        /* Tooltip text */
        .mtooltip .mtooltiptext {
            visibility: hidden;
            width: 340px;
            background-color: #000B;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;

            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
            top: 150%;
            left: 50%;
            margin-left: -170px;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .mtooltip:hover .mtooltiptext {
            visibility: visible;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-custom navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/Home/Index">SYMBOL SEARCH</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div id="navbarNavDropdown" class="navbar-collapse collapse">
                <ul class="navbar-nav mr-auto">
                    @*<li class="nav-item dropdown">*@

                        @*<select id="ddl_font" name="ddl_font"
                                    class="selectpicker" data-live-search="true">
                                @foreach (var font in fonts)
                                {
                                    <option value="@font.Id">@font.FontName</option>
                                }
                            </select>*@

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <text style="color:#00ffff">Font: </text> @fontCurrent.FontName
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                            @foreach (var font in fonts)
                            {
                                <a class="dropdown-item" href="?fontId=@font.Id">@font.FontName</a>
                            }
                        </div>
                    </li>
                    <li class="nav-item vcenter blink_me">
                        <a class="mtooltip" href="@fontCurrent.FontUrl">
                            <img class="navbar-icon" src="~/Assets/image/download.ico">
                            <text style="color:#00ffff"> Download font</text>
                            <span class="mtooltiptext">Download the font to use the below symbols (some fonts are already stored in your system, e.g. Wingdings)</span>
                        </a>
                    </li>
                    <li class="nav-item vcenter">
                        <a class="hoverx" onclick="$('#modal_feedback').modal('show')">
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<text style="color:#ffffff"> <b>|Gửi phản hồi|</b> </text>
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <div class="search-bar">
                            @using (Html.BeginForm("Index", "Home", FormMethod.Post, new { id = "frmSearch" }))
                            {
                                <input name="fontId" type="number" hidden value="@fontCurrent.Id" />
                                <input name="key" type="text" class="search-bar" placeholder="Search..">
                                <input type="submit" style="display:none" />
                                <i class="fa fa-search hoverx" style="color: black;" onclick="$('#frmSearch').submit()"></i>
                            }


                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <div id="font_id" class="hidden">0</div>
    <div class="container" style="margin-top: 50px">



        @*<select id="ddl_font" name="ddl_font"
                        class="selectpicker" data-live-search="true">
                    @foreach (var font in fonts)
                {
                    <option value="@font.Id">@font.FontName</option>
            }
                </select>*@

        <div class="row row-padding-top">
            @foreach (var symbol in symbols)

            {
                <div class="symbol-container">
                    <div class="symbol-area">
                        <div id="symbol_@symbol.Id" class="symbol myFont hoverx" onclick="copyText('symbol_@symbol.Id')">
                            <font id="symbol_@(symbol.Id)_sub" size="8" face="@fontCurrent.FontName">@symbol.Content</font>
                        </div>

                        <div class="key">
                            @if (symbol.Tags != null && symbol.Tags.Count > 0)
                            {
                                <text>@symbol.Tags.ElementAt(0).TagString</text>
                            }
                            @if (symbol.Tags.Count > 1)
                            {
                                for (int i = 1; i < symbol.Tags.Count; i++)
                                {
                                    <text>, @(symbol.Tags[i].TagString)</text>
                                }
                            }
                        </div>
                    </div>
                </div>
            }

        </div>
    </div>

    <!-- The actual snackbar -->
    <div id="snackbar">Copied.</div>

    <div id="modal_feedback"
         class="modal fade">
        <div class="modal-dialog" role="dialog">
            <div class="modal-content">
                <div class="panel" style="padding:10px">
                    Chào mừng bạn đến với trang phản hồi
                    <hr style="margin-top:1px"/>
                    Bạn là 
                    <input
                           id="feed_name"
                           type="text"
                           placeholder="Có thể bỏ trống" 
                           style="width:70%"
                           />
                    <br />
                    Email&nbsp;
                    <input
                           id="feed_email"
                           type="text"
                           placeholder="Có thể bỏ trống" 
                           style="width:70%"
                           />
                    <br />                    
                    <br />Bạn thấy màu sắc của trang web này như thế nào
                    <div style="border:dashed;border-width:1px;padding:5px">
                        Thanh điều hướng<br />
                        <input id="feed_color_navi"
                               type="text"
                               placeholder="(Ổn), hoặc có góp ý"
                               style="width:100%" />
                        <br />Nền web<br />
                        <input id="feed_color_body"
                               type="text"
                               placeholder="(Ổn), (Nên dùng màu tối (như thế nào đó)), hoặc có góp ý khác"
                               style="width:100%" />
                        <br />Các thẻ<br />
                        <input id="feed_color_item"
                               type="text"
                               placeholder="(Ổn), (Nên dùng màu tối (như thế nào đó)), hoặc có góp ý khác" 
                               style="width:100%"/>
                    </div>
                    <br />Bạn có góp ý gì về chức năng không?
                    <div style="border:dashed;border-width:1px;padding:5px;margin-bottom:3px">
                        Khi click vào symbol trên web<br />
                        <form>
                            <input type="radio" name="feed_func_item"
                                   value="Như cũ"/>
                            <text class="hoverx" onclick="focusRadio(0)">Như hiện tại, click vào là copy ngay</text><br />
                            <input type="radio" name="feed_func_item"
                                   value="Mở info"/>
                            <text class="hoverx" onclick="focusRadio(1)">Hiện ra bảng thông tin, cho phép copy ký tự, hoặc copy hình, hoặc hiển thị thông tin chi tiết</text><br />
                            <input type="radio" name="feed_func_item"
                                   value="Khác"/>
                            <input id="feed_func_orther" type="text"
                                   placeholder="Khác" style="width:90%"
                                   onclick="focusRadio(2)"/>
                        </form>
                    </div>
                    <br />Khác<br />
                    <textarea id="feed_overall"
                              placeholder="(Tổng thể trang web này...&#13;&#10;Theo bạn thì trang web này dùng để làm gì, nó có hữu ích không?&#13;&#10;Góp ý khác...)"
                              rows="3"
                              style="width:100%"
                              ></textarea>
                    <br />
                    <div style="text-align:center">
                        <button class="btn btn-info" onclick="feedback()">Gửi phản hồi</button>
                    </div>
                    
                </div>

            </div>
        </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="~/Assets/js/jquery-3.3.1.min.js"></script>
    <script src="~/Scripts/umd/popper.min.js"></script>
    <script src="~/Assets/js/bootstrap.min.js"></script>
    <script src="~/Scripts/bootstrap-select.min.js"></script>
    <script src="~/Scripts/clipboard-polyfill.js"></script>
    @*<script src="~/Assets/js/punycode.min.js"></script>*@
    <script type="text/javascript">
        function copyText(id) {
            var dt = new clipboard.DT();
            dt.setData("text/plain", $('#' + id + '_sub').html());
            //'<font face="@fontCurrent.FontName">' + $('#' + id + '_sub').html() +'</font>'
            // '<span style="font-family: FontAwesome;">' + $('#' + id + '_sub').html() + '</span>'
            //dt.setData("text/html", '<font face="@fontCurrent.FontName">' + $('#' + id + '_sub').html() +'</font>');
            clipboard.write(dt);

            showSnackbar();

            //alert('We cannot access your clipboard/rtf.\nPlease manual change the font of symbol (in Word) to match the website font')
        }

        function showSnackbar() {
            // Get the snackbar DIV
            var x = document.getElementById("snackbar")

            // Add the "show" class to DIV
            x.className = "show";

            // After 3 seconds, remove the show class from DIV
            setTimeout(function () { x.className = x.className.replace("show", ""); }, 5000);
        }

        function feedback() {
            $('#modal_feedback').modal('hide');
            var content = getFeedback();

            $.ajax({
                url: '/Home/Feedback/',
                type: "POST",
                data: { 'content': content},
                dataType: 'json',
                success: function (result) {
                    alert(result.text);
                },
                error: function (err) {
                    showError(err);
                    alert(err.statusText);
                }
            });
        }

        function getDataRadio() {

            var radios = document.getElementsByName('feed_func_item');
            for (var i = 0, length = radios.length; i < length; i++) {
                if (radios[i].checked) {
                    if (radios[i].value == "Khác") {
                        return $('#feed_func_orther').val();
                    }
                    else {
                        return radios[i].value;
                    }
                }
            }

            return "";
        }

        function focusRadio(index) {
            var radios = document.getElementsByName('feed_func_item');
            if (index >= radios.length)
                return;
            radios[index].checked = true;
        }

        function getFeedback() {
            var str = "";

            var name = $('#feed_name').val();
            var email = $('#feed_email').val();
            if (name || email) {
                if (name) {
                    str += '- Name: ' + name + '\n';
                }
                if (email) {
                    str += '- Email: ' + email + '\n';
                }
                str += '\n';
            }
            

            var color_navi = $('#feed_color_navi').val();
            var color_body = $('#feed_color_body').val();
            var color_item = $('#feed_color_item').val();
            if (color_navi || color_body || color_item) {
                str += '- Color------\n';
                if (color_navi) {
                    str += '--- navigate bar: ' + color_navi + '\n';
                }
                if (color_body) {
                    str += '--- body: ' + color_body + '\n';
                }
                if (color_item) {
                    str += '--- item: ' + color_item + '\n';
                }
                str += '\n';
            }

            var radio = getDataRadio();
            if (radio) {
                str += '- Function------\n' +
                    '--- item click: ' + radio + '\n\n';
            }            
            
            if ($('#feed_overall').val()) {
                str += '- Overall------\n' + $('#feed_overall').val();
            }

            return str;
        }

        function showError(err) {
            var win = window.open("", "MsgWindow", "width=1366,height=768");
            win.document.write(err.responseText);
            win.focus();
        }

        @*function parseItem(symbol) {
            var str = '<div class="symbol-container">\
    <div class="symbol-area">\
        <div id="symbol_' + symbol.Id + '" class="symbol myFont hoverx" onclick="' + "copyText('symbol_" + symbol.Id + "')" + '">\
            <font id="symbol_' + symbol.Id + '_sub" size="8" face="@fontCurrent.FontName">' + symbol.Content + '</font>\
        </div>\
\
        <div class="key">';
            if (symbol.Tags)

            @if (symbol.Tags != null && symbol.Tags.Count > 0)\
            {\
<text>@symbol.Tags.ElementAt(0).TagString</text>\
            }\
            @if (symbol.Tags.Count > 1)\
            {\
for (int i = 1; i < symbol.Tags.Count; i++)\
{\
    <text>, @(symbol.Tags[i].TagString)</text>\
}\
            }
        str += '</div>\
    </div>\
</div>'
        }

        function representTags(tags) {
            if (tag.length)
        }*@
    </script>
</body>
</html>

