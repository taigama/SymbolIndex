@{
    ViewBag.Title = "Xem Font";
    Layout = "~/Views/Shared/Admin_Layout.cshtml";

    SymbolIndex.Models.Font fontCurrent = ViewBag.FontCurrent;
    IList<SymbolIndex.Models.Symbol> symbols = ViewBag.Symbols;
}

<h2>ViewFont</h2>

@*@using (Html.BeginForm())
{
    <input name="Id" type="hidden" value="@fontCurrent.Id" />
    <input name="isOverwite" type="checkbox" value="Is overwrite?" />
    <input name="genSymbols" type="submit" value="Generate symbols" />
}*@

<button class="btn btn-primary" onclick="getAllSymbol()">auto generate list of symbol (and overwrite)</button>

<div class="row">
    <div class="col-lg-12">

        <div class="row">
            <div class="col-lg-12">
                <!-- Breadcrumb-->
                <nav aria-label="breadcrumb" role="navigation" style="margin-top: 20px">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="/Admin/">Bảng điều khiển</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="/Admin/FontList/">Quản lý font</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Font: @fontCurrent.FontName</li>
                    </ol>
                </nav>
                <!-- End Breadcrumb-->
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading" style="background-color:rgb(1, 85, 180); color:aliceblue">
                <i class="fa fa-file-text fa-fw"></i> Danh sách font
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div class="table-responsive">
                    @* ---- table head ----*@

                    <div style="height:60px;overflow: hidden; overflow-y:scroll;">
                        <table class="table table-striped table-bordered" style="margin-bottom:0">
                            <thead>
                                <tr>
                                    <th style="width:5%">
                                        S ID
                                    </th>
                                    <th style="width:5%">
                                        Kí tự
                                    </th>
                                    <th style="width:10%">
                                        Tên gốc
                                    </th>
                                    <th style="width:65%">
                                        Tags (phân biệt bởi ',')
                                    </th>
                                    <th style="width:15%"></th>
                                </tr>
                            </thead>
                        </table>
                    </div>

                    
                    @* ---- table body ----*@
                    <div style="height:300px;overflow: hidden; overflow-y:scroll;" id="div_table">
                        <table class="table table-striped table-bordered table-hover" id="table_content">
                            <tbody id="list">
                                @foreach (var symbol in symbols)
                            {
                                <tr>
                                    <td style="width:5%">
                                        @Html.DisplayFor(modelItem => symbol.Id)
                                    </td>
                                    <td style="width:5%">
                                        <font face="@fontCurrent.FontName">
                                            @Html.DisplayFor(modelItem => symbol.Content)
                                        </font>
                                    </td>
                                    <td style="width:10%">
                                    </td>
                                    <td style="width:65%;word-wrap:break-word">
                                        <input id="tags_@symbol.Id" style="width:100%;padding-left:2px;padding-right:2px"
                                               value="@SymbolIndex.Data.SIExtension.ToString(symbol.Tags)"/>
                                    </td>
                                    <td style="width:15%"></td>
                                </tr>
                        }
                            </tbody>
                        </table>
                    </div>
                    @* bottom line*@



                </div>
                <!-- /.table-responsive -->
            </div>
            <!-- /.panel-body -->
        </div>


    </div>
</div>


@section AddToHead{
    <link href="~/Assets/css/mycss.css" rel="stylesheet" type="text/css" />
    <style>

        @@font-face {
            font-family: '@fontCurrent.FontName';
            src: url(@fontCurrent.FontUrl);
        }
        .myFont{
                font-family: '@fontCurrent.FontName';
            }

        .symbol-container {
            display: inline-block;
            width: 12.5%;
            padding: 10px;
            min-width: 90px;
        }
        .symbol-area {
            width: 80px;
            height: 120px;
            border-color: #D1D1D1;
            border-style: solid;
            border-radius: 10px;
            border-width: 0.5px;
            background-color: #FFF;
        }
    </style>
}
<script src="~/Scripts/dist/opentype.min.js"></script>
<script>
    var font;

    function getAllSymbol() {
        var path = '@fontCurrent.FontUrl';

        if (!path) {
            alert('this font has no path!');
        }

        opentype.load(path, function (err, font) {
            if (err) {
                showErrorMessage(err.toString());
                return;
            }
            onFontLoaded(font);
        });
    }

    function onFontLoaded(font) {
        window.font = font;

        alert('unicode of #8' + font.glyphs.glyphs[8].unicode);


        //var w = cellWidth - cellMarginLeftRight * 2,
        //    h = cellHeight - cellMarginTop - cellMarginBottom,
        //    head = font.tables.head,
        //    maxHeight = head.yMax - head.yMin;
        //fontScale = Math.min(w / (head.xMax - head.xMin), h / maxHeight);
        //fontSize = fontScale * font.unitsPerEm;
        //fontBaseline = cellMarginTop + h * head.yMax / maxHeight;

        //var pagination = document.getElementById("pagination");
        //pagination.innerHTML = '';
        //var fragment = document.createDocumentFragment();
        //var numPages = Math.ceil(font.numGlyphs / cellCount);
        //for (var i = 0; i < numPages; i++) {
        //    var link = document.createElement('span');
        //    var lastIndex = Math.min(font.numGlyphs - 1, (i + 1) * cellCount - 1);
        //    link.textContent = i * cellCount + '-' + lastIndex;
        //    link.id = 'p' + i;
        //    link.addEventListener('click', pageSelect, false);
        //    fragment.appendChild(link);
        //    // A white space allows to break very long lines into multiple lines.
        //    // This is needed for fonts with thousands of glyphs.
        //    fragment.appendChild(document.createTextNode(' '));
        //}
        //pagination.appendChild(fragment);

        //initGlyphDisplay();
        //displayGlyphPage(0);
        //displayGlyph(-1);
        //displayGlyphData(-1);
    }

    function displayGlyphPage(pageNum) {
        pageSelected = pageNum;
        document.getElementById('p' + pageNum).className = 'page-selected';
        var firstGlyph = pageNum * cellCount;
        for (var i = 0; i < cellCount; i++) {
            renderGlyphItem(document.getElementById('g' + i), firstGlyph + i);
        }
    }

    function renderGlyphItem(canvas, glyphIndex) {
        var cellMarkSize = 4;
        var ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, cellWidth, cellHeight);
        if (glyphIndex >= font.numGlyphs) return;

        ctx.fillStyle = '#606060';
        ctx.font = '9px sans-serif';
        ctx.fillText(glyphIndex, 1, cellHeight - 1);
        var glyph = font.glyphs.get(glyphIndex),
            glyphWidth = glyph.advanceWidth * fontScale,
            xmin = (cellWidth - glyphWidth) / 2,
            xmax = (cellWidth + glyphWidth) / 2,
            x0 = xmin;

        ctx.fillStyle = '#a0a0a0';
        ctx.fillRect(xmin - cellMarkSize + 1, fontBaseline, cellMarkSize, 1);
        ctx.fillRect(xmin, fontBaseline, 1, cellMarkSize);
        ctx.fillRect(xmax, fontBaseline, cellMarkSize, 1);
        ctx.fillRect(xmax, fontBaseline, 1, cellMarkSize);

        ctx.fillStyle = '#000000';
        glyph.draw(ctx, x0, fontBaseline, fontSize);
    }

    
</script>